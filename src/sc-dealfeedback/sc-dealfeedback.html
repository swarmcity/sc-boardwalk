<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">

<link rel="import" href="../../bower_components/sc-style/sc-style.html">
<link rel="import" href="../../bower_components/sc-iconset/sc-iconset.html">

<link rel="import" href="../sc-loader/sc-loader.html">
<link rel="import" href="../sc-redux/sc-redux.html">


<!--
`sc-dealfeedback`

This components is the representation of a request in the requests-list on sc-hashtag. 

@demo src/sc-dealfeedback/demo/index.html 
-->

<dom-module id="sc-dealfeedback">
  <template>
    <style include="sc-styles">
      :host {
        display: block;
        box-sizing:border-box;
/*        padding-top: 20px;
        padding-bottom: 20px;*/
      }

      .feedback_step {
        margin: 4px 0px;
      }

      sc-loader {
        margin-top: 9px;
      }

      .dealcreate_steps {
/*        background-color: rgba(36,177,255,0.1);*/

        box-sizing:border-box;
        padding: 10px 10px 10px 0px;

/*        border-top: 2px dotted rgba(0,0,0,0.05);
        border-bottom: 2px dotted rgba(0,0,0,0.05);*/

/*        border-top: 2px dotted rgba(36,177,255,0.5);
        border-bottom: 2px dotted rgba(36,177,255,0.5);*/
      }


      .triangle {
        width: 10px;
        transition: all 0.075s linear;
        margin-right: 8px;
        margin-left: 4px;
        margin-bottom: 3px;

        opacity: 1;
      }

      .triangle svg {
        width: 100%;
      }

      .opened {
        transform: rotate(90deg);
        opacity: 0.75;
      }



      @media all and (min-width: 0) and (max-width: 420px) { 
      }

    </style>

     <template is="dom-if" if="{{compact}}">
      <template is="dom-if" if="{{_is(showsteps,'create')}}">
        <p class="small grey2 semibold">{{createstep}}</p>
      </template>
    </template>



     <template is="dom-if" if="{{!compact}}">


<template is="dom-if" if="{{_is(showsteps,'all')}}">
  <p>All steps, baby! {{step}}/4</p>
    <div class="feedback_step totalwidth horizont center startjust" on-tap="switchstateOne">
      <template is="dom-if" if="{{_is(steponestate,'init')}}">
        <p class="reg grey2">{{steponemsg}}</p>
        <iron-icon icon="sc-icons:v" class="grey2">not done yet</iron-icon>
      </template>
      <template is="dom-if" if="{{_is(steponestate,'doing')}}">
        <p class="reg grey3">{{steponemsg}}</p>
        <sc-loader small color="blue"></sc-loader>
      </template>
      <template is="dom-if" if="{{_is(steponestate,'done')}}">
        <p class="reg grey3">{{steponemsg}}</p>
        <iron-icon icon="sc-icons:v" class="green">done</iron-icon>
      </template>
    </div>


    <div id="steptwo" class="feedback_step totalwidth horizont center startjust" on-tap="switchstateTwo">
      <template is="dom-if" if="{{_is(steptwostate,'init')}}">
        <p class="reg grey2">{{steptwomsg}}</p>
        <iron-icon icon="sc-icons:v" class="grey2">not done yet</iron-icon>
      </template>
      <template is="dom-if" if="{{_is(steptwostate,'doing')}}">
        <p class="reg grey3">{{steptwomsg}}</p>
        <sc-loader small color="blue"></sc-loader>
      </template>
      <template is="dom-if" if="{{_is(steptwostate,'done')}}">
        <p class="reg grey3">{{steptwomsg}}</p>
        <iron-icon icon="sc-icons:v" class="green">done</iron-icon>
      </template>
    </div>


    <div id="stepthree" class="feedback_step totalwidth horizont center startjust" on-tap="switchstateThree">
      <template is="dom-if" if="{{_is(stepthreestate,'init')}}">
        <p class="reg grey2">{{stepthreemsg}}</p>
        <iron-icon icon="sc-icons:v" class="grey2">not done yet</iron-icon>
      </template>
      <template is="dom-if" if="{{_is(stepthreestate,'doing')}}">
        <p class="reg grey3">{{stepthreemsg}}</p>
        <sc-loader small color="blue"></sc-loader>
      </template>
      <template is="dom-if" if="{{_is(stepthreestate,'done')}}">
        <p class="reg grey3">{{stepthreemsg}}</p>
        <iron-icon icon="sc-icons:v" class="green">done</iron-icon>
      </template>
    </div>
    
 
    <div id="stepfour" class="feedback_step totalwidth horizont center startjust" on-tap="switchstateFour">
      <template is="dom-if" if="{{_is(stepfourstate,'init')}}">
        <p class="reg grey2">{{stepfourmsg}}</p>
        <iron-icon icon="sc-icons:v" class="grey2">not done yet</iron-icon>
      </template>
      <template is="dom-if" if="{{_is(stepfourstate,'doing')}}">
        <p class="reg grey3">{{stepfourmsg}}</p>
        <sc-loader small color="blue"></sc-loader>
      </template>
      <template is="dom-if" if="{{_is(stepfourstate,'done')}}">
        <p class="reg grey3">{{stepfourmsg}}</p>
        <iron-icon icon="sc-icons:v" class="green">done</iron-icon>
      </template>
    </div>
</template>



<template is="dom-if" if="{{_is(showsteps,'create')}}">
<!--   <p>Creating your request</p> -->

                  <div class="dealcreate_steps totalwidth">
                    <div class="horizont end startjust">
                      <div class$="triangle {{collapsestate}}" on-tap="collapseSteps">
                        <svg id="triangle_icon" x="0px" y="0px" viewBox="0 0 50 50" fill="#24B1FF">
                        <polygon points="6.5,4.9 6.5,44.5 42,24.9 "/>
                        </svg>
                      </div>
                      <p class="bold blue" on-tap="collapseSteps">Creating your request - {{createstep}}</p>
                      <!-- <sc-loader color="green" small on-tap="collapseSteps"></sc-loader> -->
                      <!-- <p on-tap="showSteps"></p> -->
                    </div>
                    <iron-collapse id="steps_collapser">


                    <div class="feedback_step totalwidth horizont center startjust" on-tap="switchstateOne">
                      <template is="dom-if" if="{{_is(steponestate,'init')}}">
                        <p class="reg grey2">{{steponemsg}}</p>
                        <iron-icon icon="sc-icons:v" class="grey2">not done yet</iron-icon>
                      </template>
                      <template is="dom-if" if="{{_is(steponestate,'doing')}}">
                        <p class="reg grey3">{{steponemsg}}</p>
                        <sc-loader small color="blue"></sc-loader>
                      </template>
                      <template is="dom-if" if="{{_is(steponestate,'done')}}">
                        <p class="reg grey3">{{steponemsg}}</p>
                        <iron-icon icon="sc-icons:v" class="green">done</iron-icon>
                      </template>
                    </div>


                    <div id="steptwo" class="feedback_step totalwidth horizont center startjust" on-tap="switchstateTwo">
                      <template is="dom-if" if="{{_is(steptwostate,'init')}}">
                        <p class="reg grey2">{{steptwomsg}}</p>
                        <iron-icon icon="sc-icons:v" class="grey2">not done yet</iron-icon>
                      </template>
                      <template is="dom-if" if="{{_is(steptwostate,'doing')}}">
                        <p class="reg grey3">{{steptwomsg}}</p>
                        <sc-loader small color="blue"></sc-loader>
                      </template>
                      <template is="dom-if" if="{{_is(steptwostate,'done')}}">
                        <p class="reg grey3">{{steptwomsg}}</p>
                        <iron-icon icon="sc-icons:v" class="green">done</iron-icon>
                      </template>
                    </div>
                    </iron-collapse>
                  </div>


    

</template>


      </template>


  </template>

  <script>
    Polymer({

      is: 'sc-dealfeedback',

      behaviors: [
        ReduxBehaviour
      ],

      observers: [
        // '_log(item)'
        '_dealstate(steponestate,steptwostate,stepthreestate,stepfourstate)'
      ],

      properties: {
        /**
       * .
       */
        dealstate: {
          type: String,
          notify: true
        },

        showsteps: {
          type: String,
          value: 'all'
        },

        // allsteps: {
        //   type: Boolean,
        //   value: false
        // },


        compact: {
          type: Boolean,
          value: false
        }
      },

      ready: function(){
          this.dealstate = "dealinit";


        this.steponestate = "init";
        this.steponemsg = "Create dealcontract";

        this.steptwostate = "init";
        this.steptwomsg = "Add funds of requester";

        this.stepthreestate = "init";
        this.stepthreemsg = "Assigned provider";

        this.stepfourstate = "init";
        this.stepfourmsg = "Add funds of provider";

        var self = this;
        setTimeout(function() {
          self.steponestate = "doing";
        }, 6000);
        var self = this;
        setTimeout(function() {
          self.steponestate = "done";
        }, 8000);
        setTimeout(function() {
          self.steptwostate = "doing";
        }, 10000);
        var self = this;
        setTimeout(function() {
          self.steptwostate = "done";
        }, 12000);
        // setTimeout(function() {
        //   self.stepthreestate = "doing";
        // }, 14000);
        // setTimeout(function() {
        //   self.stepthreestate = "done";
        // }, 16000);
        // setTimeout(function() {
        //   self.stepfourstate = "doing";
        // }, 18000);
        // setTimeout(function() {
        //   self.stepfourstate = "done";
        // }, 20000);
      },

      /**
      * 'onEnter' are the behaviors that occur when the router tells this component enters the stage 
      * use this to initialize any variables to start the component
      */
      onEnter: function(){
      },

      /**
      * 'onExit' are the behaviors that occur when the router tells this component to leave the stage 
      * use this to reset any variables when leaving this component while it remains loaded.
      */
      onExit: function(){
      },


      /**
      * '_is', a function to bind a template to a certain value of a variable.
      */
      _is: function(a, b) {
        if (b === undefined){
          b = true;
        }
        return a === b;
      },


      _log: function(target) {
      },

      switchstateOne: function(){
        switch(this.steponestate){
          case 'init':
            this.steponestate = 'doing';
            break;
          case 'doing':
            this.steponestate = 'done';
            this.step = "1";
            break;
          case 'done':
            this.steponestate = 'init';
            break;
          }
      },


      switchstateTwo: function(){
        switch(this.steptwostate){
          case 'init':
            this.steptwostate = 'doing';
            break;
          case 'doing':
            this.steptwostate = 'done';
            this.step = "2";
            break;
          case 'done':
            this.steptwostate = 'init';
            break;
          }
      },


      switchstateThree: function(){
        switch(this.stepthreestate){
          case 'init':
            this.stepthreestate = 'doing';
            break;
          case 'doing':
            this.stepthreestate = 'done';
            break;
          case 'done':
            this.stepthreestate = 'init';
            break;
          }
      },


      switchstateFour: function(){
        switch(this.stepfourstate){
          case 'init':
            this.stepfourstate = 'doing';
            break;
          case 'doing':
            this.stepfourstate = 'done';
            break;
          case 'done':
            this.stepfourstate = 'init';
            break;
          }
      },


      _dealstate: function(){

        if (this.steponestate=='init' && this.steptwostate=='init' && this.stepthreestate=='init' && this.stepfourstate=='init') {
          this.dealstate = "dealinit";
          this.allsteps = "0/4";
          this.createstep = "Creating request (0/2)";
        }
        if (this.steponestate=='done' && this.steptwostate=='doing' && this.stepthreestate=='init' && this.stepfourstate=='init') {
          this.dealstate = "dealcreated";
          this.allsteps = "1/4";
          this.createstep = "Creating request (1/2)";
        }
        if (this.steponestate=='done' && this.steptwostate=='done' && this.stepthreestate=='init' && this.stepfourstate=='init') {
          this.dealstate = "dealfundedbyseeker";
          this.allsteps = "2/4";
          this.createstep = "";
          this.assignsteps = "0/2";
        }
        if (this.steponestate=='done' && this.steptwostate=='done' && this.stepthreestate=='done' && this.stepfourstate=='init') {
          this.dealstate = "providerassigned";
          this.allsteps = "3/4";
          this.assignsteps = "1/2";
        }

        // KLOPT DEZE? = Provider assigned not niet gemined, maar providertokens al wel gemined?
        if (this.steponestate=='done' && this.steptwostate=='done' && this.stepthreestate=='init' && this.stepfourstate=='done') {
          this.dealstate = "dealfundedbyprovider";
          // this.allsteps = "3/4";
          // this.assignsteps = "1/2";
        }


        if (this.steponestate=='done' && this.steptwostate=='done' && this.stepthreestate=='done' && this.stepfourstate=='done') {
          this.dealstate = "dealtopayout";
          this.allsteps = "3/4";
          this.assignsteps = "2/2";
        }

      },


      collapseSteps: function(){
        var steps = this.shadowRoot.getElementById('steps_collapser');
        steps.toggle();

        if (steps.opened){
          this.collapsestate = 'opened';
        } else {
          this.collapsestate = '';
        }

      },


    });
  </script>
</dom-module>
